FROM ubuntu:22.04

# Avoid interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install build dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    autoconf \
    automake \
    flex \
    bison \
    libssl-dev \
    git \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /build

# Copy source code
COPY . .

# Build the project and copy binaries to ubuntu22.04 directory
RUN ./autogen.sh && \
    ./configure && \
    make && \
    make install && \
    mkdir -p /build/ubuntu22.04 && \
    cp /usr/bin/s9s /build/ubuntu22.04/ && \
    cp /usr/lib/libs9s* /build/ubuntu22.04/ 2>/dev/null || true

# Set the entrypoint to the s9s binary
ENTRYPOINT ["/usr/bin/s9s"]
CMD ["--help"]
